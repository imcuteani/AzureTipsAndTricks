<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tip 194 - Azure Automation with Windows Machine with PowerShell | Azure Tips and Tricks</title>
    <meta name="description" content="">
    <link rel="apple-touch-icon" sizes="57x57" href="/AzureTipsAndTricks/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/AzureTipsAndTricks/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/AzureTipsAndTricks/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/AzureTipsAndTricks/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/AzureTipsAndTricks/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/AzureTipsAndTricks/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/AzureTipsAndTricks/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/AzureTipsAndTricks/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/AzureTipsAndTricks/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/AzureTipsAndTricks/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/AzureTipsAndTricks/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/AzureTipsAndTricks/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/AzureTipsAndTricks/favicon-16x16.png">
  <link rel="manifest" href="/AzureTipsAndTricks/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <script async="true" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    
    <link rel="preload" href="/AzureTipsAndTricks/assets/css/0.styles.9e4235cc.css" as="style"><link rel="preload" href="/AzureTipsAndTricks/assets/js/app.08cdaeb9.js" as="script"><link rel="preload" href="/AzureTipsAndTricks/assets/js/4.1e17da4f.js" as="script"><link rel="preload" href="/AzureTipsAndTricks/assets/js/109.b8cd652e.js" as="script"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/10.e20fc808.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/100.c911c2a4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/101.f21aa11e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/102.2a7080ff.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/103.ec00b13d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/104.75cd47d9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/105.1c388ee4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/106.1f85e5a2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/107.cca0d31c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/108.a9a6c0e4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/11.0969bd96.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/110.1909f742.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/111.2f794e98.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/112.b2727ad2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/113.31604a3e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/114.eee06470.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/115.4f60b440.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/116.4d6af7c9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/117.731aae70.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/118.c74ce6d3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/119.2fe927e8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/12.75e82287.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/120.97cb9fbd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/121.accbc7bd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/122.ec82cb33.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/123.6ca77b05.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/124.b82340a4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/125.858e7397.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/126.28a75776.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/127.eae128fe.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/128.0fc38a42.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/129.1f8b08fa.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/13.4af9d49f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/130.cc63a5f9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/131.53e5f57b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/132.e3430221.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/133.4e392a0d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/134.1bcd54c8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/135.6df5f755.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/136.e2dd9f53.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/137.11a022d6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/138.eaf216f5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/139.98a7dc21.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/14.ecedec02.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/140.c56dc6f9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/141.a9d10635.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/142.b3bb6081.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/143.2bacbc59.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/144.8366ce81.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/145.8572f1e1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/146.cc85093b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/147.0734ca45.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/148.a26c7c45.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/149.cf178a21.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/15.762dd9e6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/150.43dc36fe.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/151.3bee64c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/152.0866b0cc.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/153.d213b91f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/154.f1614714.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/155.b4fe122c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/156.37a0f4c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/157.ed0c8f59.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/158.a6a8c5a0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/159.a758efc4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/16.522fda2c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/160.1aa5c4d5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/161.63acdc7f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/162.7eddb638.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/163.02af52ee.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/164.9f7d3d9e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/165.8d76226b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/166.615ce18e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/167.9f58d951.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/168.4a0ca4bd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/169.bd0424ce.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/17.9d638614.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/170.1562dc66.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/171.d4530e55.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/172.6108c1cb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/173.102538c6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/174.3a9b74c2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/175.4018a9e0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/176.5595f6a2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/177.56fbc983.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/178.841f5f68.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/179.50504d4e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/18.612c9469.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/180.96d65faf.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/181.76221c69.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/182.26a0c465.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/183.bae810cb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/184.8aa58cec.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/185.f8853212.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/186.821b86b6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/187.2545688a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/188.b69aabe3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/189.64d3e38d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/19.c0662e36.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/190.11bd4155.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/191.1d95bdff.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/192.0ed065b4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/193.970e8a89.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/194.0dbc6c3b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/195.8ed71db1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/196.7c683e8a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/197.a1106578.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/198.34c83ba5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/199.b7107d8b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/20.6d9d65a3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/200.0b99926a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/201.fe6e74f2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/21.14522294.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/22.85d1808f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/23.93c6b265.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/24.00838e48.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/25.f4ce27e0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/26.4287bd58.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/27.e4b6714e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/28.793821bd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/29.ff868554.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/3.5ca0f648.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/30.28709da6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/31.3a32ad52.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/32.19e4be29.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/33.b38a1922.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/34.d8d62195.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/35.5ca3080b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/36.9fb30e5b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/37.c6d725a2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/38.c4b4fdf7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/39.b642de62.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/40.ef3ec39e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/41.aef15b42.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/42.8252409c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/43.056eff85.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/44.f99f8f98.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/45.7d49c620.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/46.4e967460.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/47.c77fff93.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/48.0ccb84a7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/49.6521472c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/5.b32c499c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/50.f9bdd22b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/51.1648bd4a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/52.fd4eaad4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/53.46207ab5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/54.7992ae70.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/55.8490a250.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/56.f51f84d9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/57.32109f3e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/58.617f2ea7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/59.141380af.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/6.c702ed47.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/60.726faf87.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/61.2c464a00.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/62.f01b5920.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/63.8fe77695.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/64.ae133c69.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/65.809a24a9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/66.031c476a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/67.bb201c13.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/68.4f42c7a5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/69.651100f9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/7.ee00b141.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/70.7784a3bb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/71.1f765412.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/72.b366ff7e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/73.ced74f55.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/74.0578f229.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/75.81869b11.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/76.4f57ee68.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/77.b3dd211b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/78.7ddd222a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/79.bbd36cf8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/8.b58c7cc8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/80.83a0b870.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/81.bc8f3dc0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/82.d489ff5e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/83.68e6a005.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/84.8f6dd38a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/85.748ac630.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/86.7c33798d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/87.a2ebd3ce.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/88.fa039b0b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/89.20e10fea.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/9.cafcbf2e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/90.8b4b59cf.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/91.d4e2e9b1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/92.baa8d109.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/93.3f069468.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/94.e68ea7cc.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/95.2df3ecbc.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/96.486b19d9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/97.fe9f0e4b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/98.d411c758.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/99.92e68de5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/vendors~docsearch.9a8918f9.js">
    <link rel="stylesheet" href="/AzureTipsAndTricks/assets/css/0.styles.9e4235cc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AzureTipsAndTricks/" class="home-link router-link-active"><img src="/AzureTipsAndTricks/files/vintage.png" alt="Azure Tips and Tricks" class="logo"> <span class="site-name can-hide">Azure Tips and Tricks</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/AzureTipsAndTricks/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://videos.azuredev.tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Videos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/AzureTipsAndTricks/#site-map" class="nav-link">eBooks</a></div><div class="nav-item"><a href="https://github.com/Microsoft/AzureTipsAndTricks/issues/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Questions?
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://microsoft.github.io/AzureTipsAndTricks/rss.xml" class="nav-link">
  RSS Feed
</a></div> <a href="https://github.com/microsoft/azuretipsandtricks" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/AzureTipsAndTricks/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://videos.azuredev.tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Videos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/AzureTipsAndTricks/#site-map" class="nav-link">eBooks</a></div><div class="nav-item"><a href="https://github.com/Microsoft/AzureTipsAndTricks/issues/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Questions?
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://microsoft.github.io/AzureTipsAndTricks/rss.xml" class="nav-link">
  RSS Feed
</a></div> <a href="https://github.com/microsoft/azuretipsandtricks" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/AzureTipsAndTricks/" class="sidebar-link">Welcome</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Tips</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Recently Added</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/AzureTipsAndTricks/blog/tip198.html" class="sidebar-link">Tip 198 - PowerShell Core on Linux is now integrated with Azure Cloud Shell</a></li><li><a href="/AzureTipsAndTricks/blog/tip197.html" class="sidebar-link">Tip 197 - Getting started with Azure API Management</a></li><li><a href="/AzureTipsAndTricks/blog/tip196.html" class="sidebar-link">Tip 196 - Testing Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip195.html" class="sidebar-link">Tip 195 - Use Azure Monitor to track custom events</a></li><li><a href="/AzureTipsAndTricks/blog/tip194.html" class="active sidebar-link">Tip 194 - Azure Automation with Windows Machine with PowerShell</a></li><li><a href="/AzureTipsAndTricks/blog/tip193.html" class="sidebar-link">Tip 193 - Build and deploy your first app with the Azure SDK for Go on Azure</a></li><li><a href="/AzureTipsAndTricks/blog/tip192.html" class="sidebar-link">Tip 192 - Getting Started with Azure Front Door</a></li><li><a href="/AzureTipsAndTricks/blog/tip191.html" class="sidebar-link">Tip 191 - Serial console access with Azure VMs - Troubleshooting and diagnosing</a></li><li><a href="/AzureTipsAndTricks/blog/tip190.html" class="sidebar-link">Tip 190 - Multi-Factor Authentication on Azure in a Nutshell</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>App Service</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>APIM</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>AzCopy</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CLI</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cloud Shell</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cognitive Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Containers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cosmos DB</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>DevOps</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Front Door</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Functions</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HD Insight</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>IoT</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Key Vault</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Logic Apps</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Machine Learning</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Media Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Monitor</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Portal</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>PowerShell</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Productivity</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SAP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SDKs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SendGrid</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SignalR</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SQL</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Virtual Machines</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>VNET</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page" data-v-0e4468e2> <div class="content default" data-v-0e4468e2><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>💡 Learn more : <a href="https://docs.microsoft.com/azure/automation/automation-intro?WT.mc_id=docs-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">An introduction to Azure Automation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>📺 Watch the video : <a href="https://www.youtube.com/watch?v=pQ9dQ13B2vM&amp;list=PLLasX02E8BPCNCK8Thcxu-Y-XcBUbhFWC&amp;index=50?WT.mc_id=youtube-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">How to use Azure Automation with PowerShell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <h4 id="azure-automation-with-windows-machine-with-powershell"><a href="#azure-automation-with-windows-machine-with-powershell" aria-hidden="true" class="header-anchor">#</a> Azure Automation with Windows Machine with PowerShell</h4> <p>As a developer, when I do something more than once, I want to automate it. <a href="https://docs.microsoft.com/azure/automation/automation-intro?WT.mc_id=docs-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">Azure Automation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> makes this very easy for most common IT tasks, like scaling Azure SQL DBs up and down and starting and stopping VMs on a schedule.</p> <p>Azure Automation is a very mature service in Azure that let's you do anything that you can think of in Azure and also on-premises in hybrid scenarios.
Basically, Azure Automation is serverless. You don't have to worry about how it runs and works, you just tell it what to do and use it. And you only <a href="https://azure.microsoft.com/pricing/details/automation?WT.mc_id=azure-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">pay for it<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> when it does something.</p> <p>Azure Automation provides lots of features out-of-the-box, which range from tracking changes in the configuration of VMs, to managing VM Operating System updates to starting and stopping VMs on a schedule.</p> <img src="/AzureTipsAndTricks/files/AutomationFeatures.png"> <p>(Azure Automation features in the Azure portal menu)</p> <p>You can also customize the job that you want Azure Automation to do for you. To do that, you can create a <strong>Runbook</strong>. You can create one from scratch or pick one from the <a href="https://gallery.technet.microsoft.com/scriptcenter/site/search?f%5B0%5D.Type=RootCategory&amp;f%5B0%5D.Value=WindowsAzure&amp;f%5B1%5D.Type=SubCategory&amp;f%5B1%5D.Value=WindowsAzure_automation&amp;f%5B1%5D.Text=Automation" target="_blank" rel="noopener noreferrer">Runbook gallery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Runbooks can contain PowerShell <strong>Modules</strong> that make up the functionality in the runbook. As with runbooks, you can create modules yourself or select them from the <a href="https://www.powershellgallery.com'" target="_blank" rel="noopener noreferrer">PowerShell gallery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;&gt;. Runbooks can also contain Python code and Python packages instead of PowerShell modules.</p> <p>All of this runs in an Azure Automation account. So the hierarchy of components looks like this:</p> <ul><li>Azure Automation account
<ul><li>Runbook
<ul><li>Module 1</li> <li>Module 2</li> <li>Module 3</li></ul></li></ul></li></ul> <h5 id="scaling-azure-vms-using-a-custom-runbook"><a href="#scaling-azure-vms-using-a-custom-runbook" aria-hidden="true" class="header-anchor">#</a> Scaling Azure VMs using a custom Runbook</h5> <p>Let's create a custom runbook that allows us to scale the VMs in our Azure subscription.</p> <p>We'll start by making sure that we have an Azure Automation Account.</p> <ol><li>In the Azure portal, find <strong>Azure Automation</strong>. You can do this by searching for it in the searchbar at the top of the portal</li> <li>If you don't have an Azure Automation Account yet, you need to create one by clicking on the button that's in the image below:</li></ol> <img src="/AzureTipsAndTricks/files/CreateAutomationAccount.png"> <p>(Create an Azure Automation Account in the Azure portal)</p> <ol start="3"><li>Now, fill out the creation wizard and create the account.</li> <li>In the menu of the Azure Automation account, we are going to make sure that we are running the latest version of the PowerShell commandlets. Click on the <strong>Modules</strong> menu item. And now, click on <strong>Update Azure Modules</strong>. Updating the modules can take a while, but this ensures that we are running the latest versions of the PowerShell commands</li></ol> <img src="/AzureTipsAndTricks/files/UpdatePowerShellModules.png"> <p>(Update PowerShell modules in the Azure portal)</p> <ol><li>Now to create the runbook that will contain PowerShell. Click on the <strong>Runbooks</strong> menu item and click on <strong>Add a runbook</strong>. This opens up the runbook creation blade</li> <li>Pick a <strong>Name</strong> for the runbook and select <strong>PowerShell</strong> as the runbook type and click <strong>Create</strong></li></ol> <img src="/AzureTipsAndTricks/files/CreateARunbook.png"> <p>(Create a runbook in the Azure portal)</p> <ol start="7"><li>We will now create the PowerShell that does the actual work. We'll start by declaring some variables</li></ol> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token keyword">param</span><span class="token punctuation">(</span> 
    <span class="token namespace">[parameter(Mandatory=$false)]</span> 
    <span class="token namespace">[bool]</span><span class="token variable">$scaleUp</span> = <span class="token boolean">$false</span><span class="token punctuation">,</span> 
    
    <span class="token namespace">[parameter(Mandatory=$false)]</span> 
    <span class="token namespace">[string]</span><span class="token variable">$ScaleUpSize</span> = <span class="token string">&quot;Standard_D2_V2&quot;</span><span class="token punctuation">,</span>

    <span class="token namespace">[parameter(Mandatory=$false)]</span> 
    <span class="token namespace">[string]</span><span class="token variable">$ScaleDownSize</span> = <span class="token string">&quot;Standard_B1ms&quot;</span>    
<span class="token punctuation">)</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The first one is going to determine if we scale up or down.
The second and third variables indicate to which tier we should scale up or down. For instance to &quot;Standard_D2_V2&quot;.</p> <ol start="8"><li>Next, we add PowerShell script to log into Azure. We do that using the AzureRunAsConnection that Azure Automation has created for us automatically</li></ol> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token keyword">try</span> 
<span class="token punctuation">{</span> 
    <span class="token string">&quot;Logging in to Azure...&quot;</span> 
    <span class="token variable">$runAsConnectionProfile</span> = Get<span class="token operator">-</span>AutomationConnection `
    <span class="token operator">-</span>Name <span class="token string">&quot;AzureRunAsConnection&quot;</span>
    Add<span class="token operator">-</span>AzureRmAccount <span class="token operator">-</span>ServicePrincipal `
    <span class="token operator">-</span>TenantId <span class="token variable">$runAsConnectionProfile</span><span class="token punctuation">.</span>TenantId `
    <span class="token operator">-</span>ApplicationId <span class="token variable">$runAsConnectionProfile</span><span class="token punctuation">.</span>ApplicationId `
    <span class="token operator">-</span>CertificateThumbprint ` <span class="token variable">$runAsConnectionProfile</span><span class="token punctuation">.</span>CertificateThumbprint <span class="token punctuation">|</span> <span class="token function">Out-Null</span>
    <span class="token function">Write-Output</span> <span class="token string">&quot;Authenticated with Automation Run As Account.&quot;</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="9"><li>Once we are successfully logged in, we can set variables that determine the tier that we scale to. When <strong>$ScaleUp</strong> is true, we use the <strong>$ScaleUpSize</strong> parameter. And when it is false, we use the <strong>$ScaleDownSize</strong> parameter</li></ol> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$scaleUp</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token variable">$ScaleSize</span>= <span class="token variable">$ScaleUpSize</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">else</span><span class="token punctuation">{</span> 
    <span class="token variable">$ScaleSize</span>= <span class="token variable">$ScaleDownSize</span> 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="10"><li>Now, for the meat of the script. In the script below, the following happens
a. First, we get all of the resource groups and loop through them
b. In each resource group, we find all of the VMs and loop through them
c. Next, we get the current size of the VM (so the pricing tier) and compare that against the size that we want to scale to. If the VM is already the same size, we don't scale it
d. Next, we check if the VM is running and stop it if it is running
e. Finally, we update the VM with the new size</li></ol> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token keyword">Function</span> <span class="token function">Start</span><span class="token operator">-</span>VMAutoScaling<span class="token punctuation">{</span> 
    <span class="token comment"># a. First, we get all of the resource groups and loop through them</span>
    <span class="token variable">$RGs</span> = Get<span class="token operator">-</span>AzureRMResourceGroup 
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$RG</span> in <span class="token variable">$RGs</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token variable">$RGN</span> = <span class="token variable">$RG</span><span class="token punctuation">.</span>ResourceGroupName 
        <span class="token variable">$VMs</span> = Get<span class="token operator">-</span>AzureRmVM <span class="token operator">-</span>ResourceGroupName <span class="token variable">$RGN</span> 
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$VM</span> in <span class="token variable">$VMs</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
                <span class="token comment"># b. In each resource group, we find all of the VMs and loop through them</span>
                <span class="token variable">$VMName</span> = <span class="token variable">$VM</span><span class="token punctuation">.</span>Name      
                <span class="token variable">$VMDetail</span> = Get<span class="token operator">-</span>AzureRmVM <span class="token operator">-</span>ResourceGroupName <span class="token variable">$RGN</span> <span class="token operator">-</span>Name <span class="token variable">$VMName</span> 
                <span class="token variable">$VMSize</span> = <span class="token variable">$VMDetail</span><span class="token punctuation">.</span>HardwareProfile<span class="token punctuation">.</span>VmSize 
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$VMSize</span> <span class="token operator">-ne</span> <span class="token variable">$ScaleSize</span><span class="token punctuation">)</span> <span class="token operator">-and</span> <span class="token punctuation">(</span><span class="token variable">$ScaleSize</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment"># c. Next, we get the current size of the VM (so the pricing tier) and compare that against the size that we want to scale to. </span>
                    <span class="token function">Write-Output</span> <span class="token string">&quot;Resource Group: <span class="token variable">$RGN</span>&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;VM Name: &quot;</span> <span class="token operator">+</span> <span class="token variable">$VMName</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Current VM Size: <span class="token variable">$VMSize</span>&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;<span class="token variable">$scaleTagSwitch</span> : <span class="token variable">$ScaleSize</span>&quot;</span>  
                    <span class="token variable">$VMStatus</span> = Get<span class="token operator">-</span>AzureRmVM <span class="token operator">-</span>ResourceGroupName <span class="token variable">$RGN</span> <span class="token operator">-</span>Name <span class="token variable">$VMName</span> <span class="token operator">-</span>Status 
                    
                    <span class="token comment"># d. Next, we check if the VM is running and stop it if it is running</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$VMStatus</span><span class="token punctuation">.</span>Statuses<span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token punctuation">.</span>DisplayStatus <span class="token operator">-eq</span> <span class="token string">&quot;VM running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
                        <span class="token function">Write-Output</span> <span class="token string">&quot;Stopping VM '<span class="token variable">$VMName</span>'&quot;</span> 
                        Stop<span class="token operator">-</span>AzureRmVM <span class="token operator">-</span>ResourceGroupName <span class="token variable">$RGN</span> <span class="token operator">-</span>Name <span class="token variable">$VMName</span> <span class="token operator">-</span>Force <span class="token punctuation">|</span> <span class="token function">Out-Null</span> 
                    <span class="token punctuation">}</span>  

                    <span class="token comment"># e. Finally, we update the VM with the new size</span>
                    <span class="token variable">$VM</span><span class="token punctuation">.</span>HardwareProfile<span class="token punctuation">.</span>VmSize = <span class="token variable">$ScaleSize</span> 
                    Update<span class="token operator">-</span>AzureRmVM <span class="token operator">-</span>VM <span class="token variable">$VM</span> <span class="token operator">-</span>ResourceGroupName <span class="token variable">$RGN</span>  
                    <span class="token function">Write-Output</span> <span class="token string">&quot;Resized VM '<span class="token variable">$VMName</span>'&quot;</span> `n  
                <span class="token punctuation">}</span>                
                <span class="token keyword">else</span><span class="token punctuation">{</span> 
                    <span class="token function">Write-Output</span> <span class="token string">&quot;VM '<span class="token variable">$VMName</span>' is exempted from scaling (Currrent VM size matches scaling size)&quot;</span> 
                <span class="token punctuation">}</span> 
            <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="11"><li>Finally, we call the <strong>Start-VMAutoscaling</strong> function</li></ol> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token comment">############################ Start autoscaling function #################### </span>
 
<span class="token function">Start</span><span class="token operator">-</span>VMAutoScaling 
<span class="token function">Write-Output</span> <span class="token string">&quot;VM Scaling Completed&quot;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="12"><li><p>The script is now ready. Click <strong>Save</strong> and click on <strong>Test pane</strong> to test it.</p></li> <li><p>In the test pane, leave all the parameters as they are and click <strong>Start</strong>. This will look for VMs in your subscription and scale them down as that is the default setting. This will only work if you have VMs in your subscription. After a while, it will succeed and show that in the output of the Test Pane</p></li></ol> <img src="/AzureTipsAndTricks/files/TestRunBook.png"> <p>(Test completed in the Azure portal)</p> <ol start="14"><li><p>Go back to the <strong>runbook edit blade</strong> (you can use the breadcrumb menu in the top to navigate back to it) and click <strong>Publish</strong>. This pushes the runbook to 'production', which means that you can now use it and schedule it.</p></li> <li><p>You should be in the blade of the runbook. If not, navigate to it. Here, you can click <strong>Schedule</strong> to set up a schedule to run this workbook on. You can, for instance, schedule the runbook to scale up every morning and scale down every evening. This will save you costs if you don't need to run powerful machines during the night</p></li></ol> <img src="/AzureTipsAndTricks/files/CreateSchedule.png"> <p>(Create a schedule for the runbook in the Azure portal)</p> <h5 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h5> <p>That's it! Now, we have automated an important task using an Azure Automation PowerShell Runbook that runs on a schedule. Sure, this script should be more sophisticated as it should maybe have more checks and balances and it should be configurable to only scale certain VMs in your subscription. But that's okay as I just wanted to show you how you can go about creating functionality like this. And remember, there are already many pre-made Azure Automation solutions available in the <a href="https://gallery.technet.microsoft.com/scriptcenter/site/search?f%5B0%5D.Type=RootCategory&amp;f%5B0%5D.Value=WindowsAzure&amp;f%5B1%5D.Type=SubCategory&amp;f%5B1%5D.Value=WindowsAzure_automation&amp;f%5B1%5D.Text=Automation" target="_blank" rel="noopener noreferrer">Runbook gallery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <div class="page-edit" data-v-0e4468e2><div class="edit-link" data-v-0e4468e2><a href="https://github.com/microsoft/azuretipsandtricks/edit/master/blog/tip194.md" target="_blank" rel="noopener noreferrer" data-v-0e4468e2>Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" data-v-0e4468e2 data-v-0e4468e2><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <section class="share" data-v-0e4468e2><h2 data-v-0e4468e2>Share</h2> <a href="https://twitter.com/intent/tweet?text=Tip 194 - Azure Automation with Windows Machine with PowerShell by @mbcrump http://azuredev.tips/blog/tip194.html" target="_blank" class="share__button" data-v-0e4468e2><i class="fab fa-twitter" data-v-0e4468e2></i> Tweet
    </a></section></div> <!----></div> <div class="page-nav" data-v-0e4468e2><p class="inner" data-v-0e4468e2><span class="prev" data-v-0e4468e2>
        ←
        <a href="/AzureTipsAndTricks/blog/tip195.html" class="prev" data-v-0e4468e2>
          Tip 195 - Use Azure Monitor to track custom events
        </a></span> <span class="next" data-v-0e4468e2><a href="/AzureTipsAndTricks/blog/tip193.html" data-v-0e4468e2>
          Tip 193 - Build and deploy your first app with the Azure SDK for Go on Azure
        </a>
        →
      </span></p></div> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/AzureTipsAndTricks/assets/js/app.08cdaeb9.js" defer></script><script src="/AzureTipsAndTricks/assets/js/4.1e17da4f.js" defer></script><script src="/AzureTipsAndTricks/assets/js/109.b8cd652e.js" defer></script>
  </body>
</html>
